include $(LINUXDIR)/.config
include $(TOP)/.config

CFLAGS += -Wall -O
CFLAGS += -DASUS
AUTH = src
IWCONTROL = src/dlisten


#INSTALL = install

all:
	make -C $(AUTH)
	make -C $(IWCONTROL)

install: all
	install -d $(INSTALLDIR)/usr/sbin
	install src/auth $(INSTALLDIR)/usr/sbin
	install src/dlisten/iwcontrol $(INSTALLDIR)/usr/sbin
	$(STRIP) $(INSTALLDIR)/usr/sbin/auth
ifeq ($(CONFIG_RTL_ETH_802DOT1X_SUPPORT),y)
	install src/auth $(INSTALLDIR)/usr/sbin/auth_eth
	$(STRIP) $(INSTALLDIR)/usr/sbin/auth_eth
endif
ifeq ($(strip $(ENABLE_CLIENT_TLS)),true)
	install -d $(INSTALLDIR)/usr/1x
	install -d $(INSTALLDIR)/bin
	# 1x.conf will be generated by 1x_module_*.conf at running time
	install src/xsup_src/config_files/xsuplicant/1x_modules_* $(INSTALLDIR)/usr/1x
	install src/rwCertSrc/rsCert $(INSTALLDIR)/bin/rsCert
endif
clean:
	make -C $(AUTH) clean
	make -C $(IWCONTROL) clean

.PHONY: all clean install libs dirs osl
